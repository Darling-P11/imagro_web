<div class="modelo-wrapper">
  <!--  Contenedor de Selecci贸n de Cultivos -->
  <div class="sidebar-container">
    <h3> Selecciona los cultivos</h3>

    <!--  rbol de selecci贸n -->
    <ul class="tree-list">
      <li *ngFor="let carpeta of elementosDescarga">
        <label (click)="toggleExpandir(carpeta, $event)">
          <input
            type="checkbox"
            [(ngModel)]="carpeta.seleccionado"
            (change)="toggleSeleccion(carpeta, $event)"
          />
          <span>
            <i
              *ngIf="carpeta.subelementos && !carpeta.abierto"
              class="ri-folder-line"
            ></i>
            <i
              *ngIf="carpeta.subelementos && carpeta.abierto"
              class="ri-folder-open-line"
            ></i>
            {{ carpeta.nombre }}
          </span>
        </label>

        <ul *ngIf="carpeta.abierto">
          <ng-container
            *ngTemplateOutlet="
              mostrarSubcarpetas;
              context: { carpetas: carpeta.subelementos }
            "
          ></ng-container>
        </ul>
      </li>
    </ul>
  </div>

  <!--  Contenido principal de Generaci贸n de Modelo -->
  <div class="modelo-container">
    <h1> Generaci贸n de Modelo IA</h1>
    <p>Selecciona los cultivos que deseas incluir en el modelo.</p>

    <!--  Bot贸n de Entrenamiento con indicador de carga -->
    <!--  Bot贸n de Entrenamiento con indicador de carga -->
    <button
      class="btn-train"
      (click)="iniciarEntrenamiento()"
      [disabled]="!tieneSeleccionadas() || cargandoModelo"
    >
      <i class="ri-brain-line"></i>
      {{ cargandoModelo ? "Entrenando..." : "Entrenar Modelo" }}
    </button>

    <!--  Indicador de progreso -->
    <div *ngIf="cargandoModelo" class="loading-container">
      <div class="spinner"></div>
      <p>El modelo est谩 entrenando. Esto puede tardar unos minutos...</p>
    </div>

    <!--  Bot贸n de descarga del modelo una vez entrenado -->
    <!--  Bot贸n de descarga del modelo una vez entrenado -->
<button
*ngIf="modeloEntrenado"
class="btn-download"
(click)="descargarModelo()"
>
<i class="ri-download-line"></i> Descargar Modelo (JSON)
</button>

  </div>
</div>

<!--  Plantilla Recursiva para Subcarpetas -->
<ng-template #mostrarSubcarpetas let-carpetas="carpetas">
  <li *ngFor="let subcarpeta of carpetas">
    <label (click)="toggleExpandir(subcarpeta, $event)">

      <input
        type="checkbox"
        [(ngModel)]="subcarpeta.seleccionado"
        (change)="toggleSeleccion(subcarpeta, $event)"
      />
      <span>
        <i
          *ngIf="subcarpeta.subelementos && !subcarpeta.abierto"
          class="ri-folder-line"
        ></i>
        <i
          *ngIf="subcarpeta.subelementos && subcarpeta.abierto"
          class="ri-folder-open-line"
        ></i>
        {{ subcarpeta.nombre }}
      </span>
    </label>

    <ul *ngIf="subcarpeta.abierto">
      <ng-container
        *ngTemplateOutlet="
          mostrarSubcarpetas;
          context: { carpetas: subcarpeta.subelementos }
        "
      ></ng-container>
    </ul>
  </li>
</ng-template>
